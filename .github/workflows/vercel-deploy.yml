name: Deploy to Vercel (Working)

on:
  push:
    branches: [preview-deployment]

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy to Staging
    environment: staging

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install dependencies and build
        run: |
          echo "=== BUILDING ==="
          npm ci
          npm run build
          ls -la dist/

      - name: Setup Vercel and Deploy
        run: |
          echo "=== DEPLOYING ==="

          # Install Vercel CLI
          npm install -g vercel

          # Create project configuration
          mkdir -p ~/.vercel
          cat > ~/.vercel/project.json << EOF
          {
            "projectId": "${{ secrets.VERCEL_PROJECT_ID }}",
            "orgId": "${{ secrets.VERCEL_ORG_ID }}"
          }
          EOF

          # Deploy without login (using token directly)
          VERCEL_ORG_ID="${{ secrets.VERCEL_ORG_ID }}" \
          VERCEL_PROJECT_ID="${{ secrets.VERCEL_PROJECT_ID }}" \
          vercel --prod --prebuilt --confirm --token "${{ secrets.VERCEL_TOKEN }}"
        id: deploy

      - name: Output Results
        run: |
          echo "=== DEPLOYMENT COMPLETE ==="
          echo "âœ… Vercel deployment initiated"
          echo "Project: ${{ secrets.VERCEL_PROJECT_ID }}"
          echo "Org: ${{ secrets.VERCEL_ORG_ID }}"
          echo ""
          echo "Note: The CLI approach may not return a URL directly"
          echo "Check Vercel dashboard for deployment status"
